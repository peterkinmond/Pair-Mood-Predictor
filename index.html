<!doctype html>

<!--[if lt IE 7]>
<html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7]>
<html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8]>
<html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">

    <title>Pair Mood Predictor</title>
    <link rel="stylesheet" href="style/screen.css" media="screen, projection">

    <script src="js/vendor/modernizr-1.6.min.js"></script>
    <script src="js/vendor/jquery-1.5.1.min.js"></script>
    <script src="js/vendor/d3.js"></script>
    <script src="js/vendor/d3.layout.js"></script>
    <script src="js/chart.js"></script>

    <script type="application/javascript">
        var mood_number = 8;   // Perfect mood is 10, start with 8

        function alterMood(checkbox, amount) {
            if (checkbox.checked) {
                mood_number += amount;
            }
            else {
                mood_number -= amount;
            }
            $('#mood_number').text(mood_number);

            var offset = mood_number;
            if (mood_number > 10) {
                offset = 10;
            }
            else if (mood_number <= 1) {
                offset = 1.5;
            }
            redrawChart(offset * 36);
        }
    </script>
</head>

<body>
<div id="title">
    <h1>Pair Mood Predictor</h1>
</div>

<div id="container">
    <h2>Temp In Office</h2>
    <input type="radio" name="office_temp" value="-2"/>Freezing<br/>
    <input type="radio" name="office_temp" value="0"/>Room temperature<br/>
    <input type="radio" name="office_temp" value="-2"/>Boiling<br/>

    <h2>Cups Of Coffee Consumed</h2>
    <input type="radio" name="cups_of_coffee" value="-1"/>0 (grrrrrr)<br/>
    <input type="radio" name="cups_of_coffee" value="1"/>1 (ah)<br/>
    <input type="radio" name="cups_of_coffee" value="2"/>2 (ahhhhhhhhh!)<br/>
    <input type="radio" name="cups_of_coffee" value="-2"/>3 or more (AHHHHHHHH!!!!!1!)<br/>

    <h2>Time Of Day</h2>
    <input type="radio" name="time_of_day" value="-1"/> 9am - Noon<br/>
    <input type="radio" name="time_of_day" value="0"/> Noon - 3pm<br/>
    <input type="radio" name="time_of_day" value="-3"/> 3pm - 6pm<br/>

    <h2>Number Of Dogs In Office</h2>
    <input type="radio" name="number_of_dogs" value="0"/>0<br/>
    <input type="radio" name="number_of_dogs" value="0"/>1<br/>
    <input type="radio" name="number_of_dogs" value="-3"/>2 or more (enough to run around engineering)<br/>

    <h2>Other Factors</h2>
    <input type="checkbox" name="vehicle" value="Bike" onclick="alterMood(this, -1)">Elevator broken (again)</input><br/>
    <input type="checkbox" name="vehicle" value="Bike" onclick="alterMood(this, -2)">Music blaring</input><br/>
    <input type="checkbox" name="vehicle" value="Bike" onclick="alterMood(this, 3)">Someone brought in
    doughnuts/muffins</input><br/>
</div>

<div id="chart" class="chart">
    <div id='arrowed'>
        <img src="images/arrow.png"/>
    </div>

    <div id="charted">

    </div>
</div>

<div id="footer">
    created by <a href="http://peterkinmond.com">peter kinmond</a>
    using <a href="http://mbostock.github.com/d3">d3.js</a>
</div>

<script type="text/javascript">
    function drawChart(rotateAngle) {
        var w = 400,
                h = 400,
                r = Math.min(w, h) / 2,
                initialAngle = -125,
                rotation = initialAngle + rotateAngle;
        text = ['elated', 'happy', 'so-so', 'angry', 'nuclear'],
                data = d3.range(text.length).map(function () {
                    return 1 / text.length;
                }),
                colours = ['#2ca02c', '#98df8a', "#ff7f0e", '#ff9896', "#d62728"],
                colour = d3.scale.ordinal().range(colours),
                donut = d3.layout.pie(),
                arc = d3.svg.arc().innerRadius(r * .5).outerRadius(r);

        var vis = d3.select("body #charted")
                .append("svg")
                .data([data])
                .attr("width", w)
                .attr("height", h);

        var arcs = vis.selectAll("g.arc")
                .data(donut)
                .enter().append("g")
                .attr("class", "arc")
                .attr("transform", "translate(" + r + "," + r + ")rotate(" + rotation + ")");

        arcs.append("path")
                .transition()
                .duration(1500)
                .attr("fill", function (d, i) {
                    return colour(i);
                })
                .attr("d", arc);

        arcs.append("text")
                .attr("transform", function (d) {
                    return "translate(" + arc.centroid(d) + ")rotate(" + (-1 * rotation) + ")";
                })
                .attr("dy", ".35em")
                .attr("text-anchor", "middle")
                .attr("display", function (d) {
                    return null;
                })
                .attr("class", "pie-piece")
                .text(function (d, i) {
                    return text[i];
                });
    }

    function redrawChart(angle) {
        var initialAngle = -125;
        angle = angle + initialAngle;

        var arcs = d3.select('body #charted')
                .selectAll('g.arc');

        arcs.transition()
                .duration(800)
                .attr("transform", "translate(200,200)rotate(" + angle + ")");

        arcs.selectAll('text')
                .transition()
                .duration(500)
                .attr("transform", function (d) {
                    return "translate(" + arc.centroid(d) + ")rotate(" + (-1 * angle) + ")";
                });

    }

</script>
</body>
</html>
